<div class="w-full flex flex-row justify-between items-center">
  <h1 [appRedirect]="AppRoutes.home">Order BOT Templater</h1>

  <p-divider layout="vertical" />

  <app-project-select [projects]="projects()" [selectedProject]="selectedProject()" (projectSelected)="selectProject($event)" (addProject)="newProject()"/>

  @for (item of menuItems(); track item.routeVal) {
    <app-header-item [label]="item.label" [selected]="selectedMenuItem() === item" [route]="item.route" [icon]="item.icon"/>
  }

  <div class="flex flex-row gap-2 items-center">
    <button
      type="button"
      class="theme-toggle"
      role="switch"
      aria-label="Toggle dark mode"
      [attr.aria-checked]="isEnabled()"
      [class.is-dark]="isEnabled()"
      (click)="toggleDarkMode()">
      <span class="icon sun" aria-hidden="true"><i class="pi pi-sun"></i></span>
      <span class="thumb" aria-hidden="true"></span>
      <span class="icon moon" aria-hidden="true"><i class="pi pi-moon"></i></span>
    </button>
  </div>

  @if (isLoggedIn | async) {
    <p-popover
      #userMenu
      appendTo="body"
      styleClass="user-menu__panel"
      [dismissable]="true"
      [autoZIndex]="true"
      (onShow)="userMenuOpen = true"
      (onHide)="userMenuOpen = false"
    >
      <div class="user-menu__content">
        <div class="user-menu__user">
          <span class="user-menu__avatar" aria-hidden="true"><i class="pi pi-user"></i></span>
          <div class="user-menu__details">
            <div class="user-menu__name">{{ displayName() }}</div>
            <div class="user-menu__hint">Prihlásený používateľ</div>
          </div>
        </div>
        <button
          type="button"
          class="user-menu__action"
          (click)="handleLogout(userMenu)"
        >
          <i class="pi pi-sign-out" aria-hidden="true"></i>
          <span>Odhlásiť sa</span>
        </button>
      </div>
    </p-popover>

    <a
      class="user-menu__trigger"
      [class.user-menu__trigger--active]="userMenuOpen"
      href="#"
      role="button"
      (click)="toggleUserMenu(userMenu, $event)"
      (keydown.enter)="toggleUserMenu(userMenu, $event)"
      (keydown.space)="toggleUserMenu(userMenu, $event)"
      [attr.aria-expanded]="userMenuOpen"
      [attr.aria-haspopup]="'menu'"
    >
      <span class="user-menu__label">{{ displayName() }}</span>
      <i class="pi" [class.pi-chevron-up]="userMenuOpen" [class.pi-chevron-down]="!userMenuOpen" aria-hidden="true"></i>
    </a>
  } @else {
    <app-header-item
      label="Login"
      [route]="AppRoutes.login"
      icon="pi pi-fw pi-sign-in"
    />
  }
</div>
